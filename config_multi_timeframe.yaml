# PatternScout 8周期配置系统
# 支持8个具体时间周期的精细化形态检测
# 重构说明：统一flag和pennant检测为flag_pattern架构
# flag: 矩形旗（平行通道），pennant: 三角旗（收敛三角形）

# 全局设置
global:
  min_data_points: 60               # 进行形态检测所需的最少数据点数
  enable_multi_timeframe: false     # 是否启用多周期同步检测功能
  default_timeframe: "auto"         # 默认时间周期（auto表示自动检测数据周期）
  enable_atr_adaptation: true       # 是否启用ATR自适应参数调整

# 数据源配置
data_sources:
  csv:
    enabled: true                   # 启用CSV数据源
    directory: "data/csv/"          # CSV文件存储目录
  mongodb:
    enabled: false                  # 启用MongoDB数据源
    host: "localhost"               # MongoDB服务器地址
    port: 27017                     # MongoDB端口
    database: "market_data"         # 数据库名称
    collection: "ohlcv"             # 集合名称

# 时间周期分类 （支持8个具体周期）
timeframe_categories:
  '1m':
    description: "1分钟周期（超高频交易）"
  '5m':
    description: "5分钟周期（高频交易）"
  '15m':
    description: "15分钟周期（短线交易）"
  '1h':
    description: "1小时周期（日内交易）"
  '4h':
    description: "4小时周期（短中线交易）"
  '1d':
    description: "日线周期（中线交易）"
  '1w':
    description: "周线周期（中长线交易）"
  '1M':
    description: "月线周期（长线交易）"

# 统一的旗形形态检测参数（按具体周期分类）
# 每个周期包含统一的flag_pattern配置，内含flag和pennant子配置
pattern_detection:
  # 1分钟周期参数（超高频交易，适应最高噪音）
  '1m':
    flagpole:
      min_bars: 3                       # 旗杆最少K线数量
      max_bars: 10                      # 旗杆最多K线数量  
      min_height_percent: 0.3           # 旗杆最小涨跌幅（%）
      max_height_percent: 2.0           # 旗杆最大涨跌幅（%）
      volume_surge_ratio: 1.3           # 成交量激增倍数（相对于20期SMA）
      max_retracement: 0.5              # 旗杆期间允许的最大回撤比例
      min_trend_strength: 0.5           # 最小趋势强度（线性回归R²值）
    flag:
      min_bars: 8                       # 旗形最少K线数量
      max_bars: 20                      # 旗形最多K线数量
      min_slope_angle: 0.5              # 旗形通道最小倾斜角度（度）
      max_slope_angle: 6                # 旗形通道最大倾斜角度（度）
      retracement_range: [0.2, 0.7]     # 旗形回撤范围（相对旗杆高度）
      volume_decay_threshold: 0.9       # 成交量衰减阈值（相对旗杆成交量）
      parallel_tolerance: 0.3           # 平行度容忍度（0-1，越小越严格）
      min_touches: 2                    # 边界线最少触及次数
    pennant:
      min_bars: 8                       # 三角旗形最少K线数量
      max_bars: 25                      # 三角旗形最多K线数量
      min_touches: 2                    # 边界线最少触及次数
      convergence_ratio: 0.6            # 收敛比例（结束宽度/开始宽度）
      apex_distance_range: [0.8, 4.0]   # 顶点距离范围（相对形态长度的倍数）
      symmetry_tolerance: 0.5           # 对称性容忍度（0-1，越小越对称）
      volume_decay_threshold: 0.9       # 成交量衰减阈值
    scoring:
      min_confidence_score: 0.6         # 最低置信度分数阈值
      
  # 5分钟周期参数（高频交易，适应高噪音）
  '5m':
    flagpole:
      min_bars: 4                       # 旗杆最少K线数量
      max_bars: 12                      # 旗杆最多K线数量  
      min_height_percent: 0.4           # 旗杆最小涨跌幅（%）
      max_height_percent: 2.5           # 旗杆最大涨跌幅（%）
      volume_surge_ratio: 1.4           # 成交量激增倍数
      max_retracement: 0.45             # 最大回撤比例
      min_trend_strength: 0.55          # 最小趋势强度
    flag:
      min_bars: 8                       # 旗形最少K线数量
      max_bars: 25                      # 旗形最多K线数量
      min_slope_angle: 0.4              # 最小倾斜角度（度）
      max_slope_angle: 7                # 最大倾斜角度（度）
      retracement_range: [0.18, 0.65]   # 回撤范围
      volume_decay_threshold: 0.85      # 成交量衰减阈值
      parallel_tolerance: 0.28          # 平行度容忍度
      min_touches: 2                    # 最少触及次数
    pennant:
      min_bars: 8                       # 三角旗形最少K线数量
      max_bars: 30                      # 三角旗形最多K线数量
      min_touches: 2                    # 最少触及次数
      convergence_ratio: 0.55           # 收敛比例
      apex_distance_range: [0.7, 3.5]   # 顶点距离范围
      symmetry_tolerance: 0.45          # 对称性容忍度
      volume_decay_threshold: 0.85      # 成交量衰减阈值
    scoring:
      min_confidence_score: 0.55       # 最低置信度分数阈值
      
  # 15分钟周期参数（短线交易，标准配置）
  '15m':
    flag_pattern:
      flagpole:
        min_bars: 5                       # 旗杆最少K线数量
        max_bars: 12                      # 旗杆最多K线数量
        min_height_percent: 0.5           # 旗杆最小涨跌幅（%）
        max_height_percent: 15.0          # 旗杆最大涨跌幅（%）
        volume_surge_ratio: 1.2           # 成交量激增倍数
        max_retracement: 0.5              # 最大回撤比例
        min_trend_strength: 0.3           # 最小趋势强度（R²值）
      flag:  # 矩形旗检测参数
        min_bars: 10                      # 旗形最少K线数量
        max_bars: 25                      # 旗形最多K线数量
        min_slope_angle: 0.1              # 最小倾斜角度（度）
        max_slope_angle: 15               # 最大倾斜角度（度）
        retracement_range: [0.1, 0.8]     # 回撤范围
        volume_decay_threshold: 0.9       # 成交量衰减阈值
        parallel_tolerance: 0.3           # 平行度容忍度
        min_touches: 1                    # 最少触及次数
      pennant:  # 三角旗检测参数
        min_bars: 4                       # 三角旗形最少K线数量
        max_bars: 50                      # 三角旗形最多K线数量
        min_touches: 1                    # 最少触及次数
        convergence_ratio: 0.3            # 收敛比例
        apex_distance_range: [0.3, 4.0]   # 顶点距离范围
        symmetry_tolerance: 0.6           # 对称性容忍度
        volume_decay_threshold: 0.9       # 成交量衰减阈值
      scoring:
        min_confidence_score: 0.3         # 最低置信度分数阈值
      
  # 1小时周期参数（日内交易）
  '1h':
    flagpole:
      min_bars: 4                       # 旗杆最少K线数量
      max_bars: 10                      # 旗杆最多K线数量
      min_height_percent: 0.8           # 旗杆最小涨跌幅（%）
      max_height_percent: 12.0          # 旗杆最大涨跌幅（%）
      volume_surge_ratio: 1.5           # 成交量激增倍数
      max_retracement: 0.4              # 最大回撤比例
      min_trend_strength: 0.4           # 最小趋势强度
    flag:
      min_bars: 8                       # 旗形最少K线数量
      max_bars: 20                      # 旗形最多K线数量
      min_slope_angle: 0.2              # 最小倾斜角度（度）
      max_slope_angle: 12               # 最大倾斜角度（度）
      retracement_range: [0.15, 0.7]    # 回撤范围
      volume_decay_threshold: 0.8       # 成交量衰减阈值
      parallel_tolerance: 0.25          # 平行度容忍度
      min_touches: 2                    # 最少触及次数
    pennant:
      min_bars: 6                       # 三角旗形最少K线数量
      max_bars: 35                      # 三角旗形最多K线数量
      min_touches: 2                    # 最少触及次数
      convergence_ratio: 0.4            # 收敛比例
      apex_distance_range: [0.4, 3.0]   # 顶点距离范围
      symmetry_tolerance: 0.5           # 对称性容忍度
      volume_decay_threshold: 0.8       # 成交量衰减阈值
    scoring:
      min_confidence_score: 0.4         # 最低置信度分数阈值
      
  # 4小时周期参数（短中线交易）
  '4h':
    flagpole:
      min_bars: 3                       # 旗杆最少K线数量
      max_bars: 8                       # 旗杆最多K线数量
      min_height_percent: 1.5           # 旗杆最小涨跌幅（%）
      max_height_percent: 12.0          # 旗杆最大涨跌幅（%）
      volume_surge_ratio: 2.0           # 成交量激增倍数（更严格）
      max_retracement: 0.3              # 最大回撤比例（更严格）
      min_trend_strength: 0.6           # 最小趋势强度（更严格）
    flag:
      min_bars: 6                       # 旗形最少K线数量
      max_bars: 18                      # 旗形最多K线数量
      min_slope_angle: 0.5              # 最小倾斜角度（度）
      max_slope_angle: 12               # 最大倾斜角度（度）
      retracement_range: [0.2, 0.6]     # 回撤范围（更严格）
      volume_decay_threshold: 0.7       # 成交量衰减阈值
      parallel_tolerance: 0.2           # 平行度容忍度（更严格）
      min_touches: 3                    # 最少触及次数（更多确认）
    pennant:
      min_bars: 6                       # 三角旗形最少K线数量
      max_bars: 22                      # 三角旗形最多K线数量
      min_touches: 3                    # 最少触及次数（更多确认）
      convergence_ratio: 0.6            # 收敛比例（更严格）
      apex_distance_range: [0.3, 2.0]   # 顶点距离范围
      symmetry_tolerance: 0.3           # 对称性容忍度（更严格）
      volume_decay_threshold: 0.7       # 成交量衰减阈值
    scoring:
      min_confidence_score: 0.5         # 最低置信度分数阈值

  # 日线周期参数（中线交易，更严格要求）
  '1d':
    flagpole:
      min_bars: 3                       # 旗杆最少K线数量
      max_bars: 8                       # 旗杆最多K线数量
      min_height_percent: 2.0           # 旗杆最小涨跌幅（%）
      max_height_percent: 15.0          # 旗杆最大涨跌幅（%）
      volume_surge_ratio: 2.5           # 成交量激增倍数（更严格）
      max_retracement: 0.2              # 最大回撤比例（更严格）
      min_trend_strength: 0.8           # 最小趋势强度（更严格）
    flag:
      min_bars: 5                       # 旗形最少K线数量
      max_bars: 20                      # 旗形最多K线数量
      min_slope_angle: 1                # 最小倾斜角度（度）
      max_slope_angle: 15               # 最大倾斜角度（度）
      retracement_range: [0.2, 0.5]     # 回撤范围（更严格）
      volume_decay_threshold: 0.6       # 成交量衰减阈值
      parallel_tolerance: 0.1           # 平行度容忍度（更严格）
      min_touches: 4                    # 最少触及次数（更多确认）
    pennant:
      min_bars: 5                       # 三角旗形最少K线数量
      max_bars: 25                      # 三角旗形最多K线数量
      min_touches: 4                    # 最少触及次数（更多确认）
      convergence_ratio: 0.7            # 收敛比例（更严格）
      apex_distance_range: [0.3, 1.5]   # 顶点距离范围
      symmetry_tolerance: 0.2           # 对称性容忍度（更严格）
      volume_decay_threshold: 0.6       # 成交量衰减阈值
    scoring:
      min_confidence_score: 0.7         # 最低置信度分数阈值（更高要求）

  # 周线周期参数（中长线交易，非常严格）
  '1w':
    flagpole:
      min_bars: 2                       # 旗杆最少K线数量
      max_bars: 6                       # 旗杆最多K线数量
      min_height_percent: 3.0           # 旗杆最小涨跌幅（%）
      max_height_percent: 20.0          # 旗杆最大涨跌幅（%）
      volume_surge_ratio: 3.0           # 成交量激增倍数（非常严格）
      max_retracement: 0.15             # 最大回撤比例（非常严格）
      min_trend_strength: 0.85          # 最小趋势强度（非常严格）
    flag:
      min_bars: 4                       # 旗形最少K线数量
      max_bars: 15                      # 旗形最多K线数量
      min_slope_angle: 1.5              # 最小倾斜角度（度）
      max_slope_angle: 12               # 最大倾斜角度（度）
      retracement_range: [0.25, 0.45]   # 回撤范围（非常严格）
      volume_decay_threshold: 0.5       # 成交量衰减阈值
      parallel_tolerance: 0.08          # 平行度容忍度（非常严格）
      min_touches: 5                    # 最少触及次数（非常多确认）
    pennant:
      min_bars: 4                       # 三角旗形最少K线数量
      max_bars: 18                      # 三角旗形最多K线数量
      min_touches: 5                    # 最少触及次数（非常多确认）
      convergence_ratio: 0.8            # 收敛比例（非常严格）
      apex_distance_range: [0.2, 1.2]   # 顶点距离范围
      symmetry_tolerance: 0.15          # 对称性容忍度（非常严格）
      volume_decay_threshold: 0.5       # 成交量衰减阈值
    scoring:
      min_confidence_score: 0.8         # 最低置信度分数阈值（非常高要求）

  # 月线周期参数（长线交易，最严格要求）
  '1M':
    flagpole:
      min_bars: 2                       # 旗杆最少K线数量
      max_bars: 5                       # 旗杆最多K线数量
      min_height_percent: 5.0           # 旗杆最小涨跌幅（%）
      max_height_percent: 30.0          # 旗杆最大涨跌幅（%）
      volume_surge_ratio: 4.0           # 成交量激增倍数（最严格）
      max_retracement: 0.1              # 最大回撤比例（最严格）
      min_trend_strength: 0.9           # 最小趋势强度（最严格）
    flag:
      min_bars: 3                       # 旗形最少K线数量
      max_bars: 12                      # 旗形最多K线数量
      min_slope_angle: 2                # 最小倾斜角度（度）
      max_slope_angle: 10               # 最大倾斜角度（度）
      retracement_range: [0.3, 0.4]     # 回撤范围（最严格）
      volume_decay_threshold: 0.4       # 成交量衰减阈值
      parallel_tolerance: 0.05          # 平行度容忍度（最严格）
      min_touches: 6                    # 最少触及次数（最多确认）
    pennant:
      min_bars: 3                       # 三角旗形最少K线数量
      max_bars: 15                      # 三角旗形最多K线数量
      min_touches: 6                    # 最少触及次数（最多确认）
      convergence_ratio: 0.85           # 收敛比例（最严格）
      apex_distance_range: [0.15, 1.0]  # 顶点距离范围
      symmetry_tolerance: 0.1           # 对称性容忍度（最严格）
      volume_decay_threshold: 0.4       # 成交量衰减阈值
    scoring:
      min_confidence_score: 0.85        # 最低置信度分数阈值（最高要求）

# 统一形态质量评分权重（按具体周期调整）
scoring_weights:
  flag_pattern:
    flag:  # 矩形旗评分权重
      '1m':
        slope_direction: 0.18             # 斜率方向权重（旗形应与旗杆方向相反）
        parallel_quality: 0.18            # 平行度质量权重（上下边界线平行程度）
        volume_pattern: 0.35              # 成交量模式权重（成交量应逐渐衰减）
        channel_containment: 0.19         # 通道包含性权重（价格在通道内的程度）
        time_proportion: 0.10             # 时间比例权重（形态持续时间合理性）
    '5m':
      slope_direction: 0.20             # 斜率方向权重
      parallel_quality: 0.20            # 平行度质量权重
      volume_pattern: 0.32              # 成交量模式权重
      channel_containment: 0.18         # 通道包含性权重
      time_proportion: 0.10             # 时间比例权重
    '15m':
      slope_direction: 0.25             # 斜率方向权重
      parallel_quality: 0.25            # 平行度质量权重
      volume_pattern: 0.25              # 成交量模式权重
      channel_containment: 0.15         # 通道包含性权重
      time_proportion: 0.10             # 时间比例权重
    '1h':
      slope_direction: 0.28             # 斜率方向权重
      parallel_quality: 0.27            # 平行度质量权重
      volume_pattern: 0.22              # 成交量模式权重
      channel_containment: 0.13         # 通道包含性权重
      time_proportion: 0.10             # 时间比例权重
    '4h':
      slope_direction: 0.30             # 斜率方向权重（中线更重视方向性）
      parallel_quality: 0.30            # 平行度质量权重（中线要求更严格）
      volume_pattern: 0.20              # 成交量模式权重
      channel_containment: 0.10         # 通道包含性权重
      time_proportion: 0.10             # 时间比例权重
    '1d':
      slope_direction: 0.30             # 斜率方向权重（长周期更重视方向性）
      parallel_quality: 0.30            # 平行度质量权重（长周期要求更严格）
      volume_pattern: 0.20              # 成交量模式权重
      channel_containment: 0.10         # 通道包含性权重
      time_proportion: 0.10             # 时间比例权重
    '1w':
      slope_direction: 0.32             # 斜率方向权重
      parallel_quality: 0.33            # 平行度质量权重
      volume_pattern: 0.18              # 成交量模式权重
      channel_containment: 0.07         # 通道包含性权重
      time_proportion: 0.10             # 时间比例权重
    '1M':
      slope_direction: 0.35             # 斜率方向权重（最重视方向性）
      parallel_quality: 0.35            # 平行度质量权重（最严格要求）
      volume_pattern: 0.15              # 成交量模式权重
      channel_containment: 0.05         # 通道包含性权重
      time_proportion: 0.10             # 时间比例权重
      
  pennant:
    '1m':
      convergence_quality: 0.22         # 收敛质量权重（三角形收敛程度）
      symmetry: 0.18                    # 对称性权重（上下边界对称程度）
      volume_pattern: 0.35              # 成交量模式权重（超短周期更重视成交量）
      size_proportion: 0.15             # 尺寸比例权重（相对旗杆的大小）
      apex_validity: 0.10               # 顶点有效性权重（交点位置合理性）
    '5m':
      convergence_quality: 0.25         # 收敛质量权重
      symmetry: 0.20                    # 对称性权重
      volume_pattern: 0.32              # 成交量模式权重
      size_proportion: 0.13             # 尺寸比例权重
      apex_validity: 0.10               # 顶点有效性权重
    '15m':
      convergence_quality: 0.30         # 收敛质量权重
      symmetry: 0.25                    # 对称性权重
      volume_pattern: 0.25              # 成交量模式权重
      size_proportion: 0.10             # 尺寸比例权重
      apex_validity: 0.10               # 顶点有效性权重
    '1h':
      convergence_quality: 0.32         # 收敛质量权重
      symmetry: 0.28                    # 对称性权重
      volume_pattern: 0.22              # 成交量模式权重
      size_proportion: 0.08             # 尺寸比例权重
      apex_validity: 0.10               # 顶点有效性权重
    '4h':
      convergence_quality: 0.35         # 收敛质量权重（中线最重视收敛质量）
      symmetry: 0.30                    # 对称性权重（中线要求高对称性）
      volume_pattern: 0.20              # 成交量模式权重
      size_proportion: 0.05             # 尺寸比例权重（中线不太关注大小）
      apex_validity: 0.10               # 顶点有效性权重
    '1d':
      convergence_quality: 0.35         # 收敛质量权重（长周期最重视收敛质量）
      symmetry: 0.30                    # 对称性权重（长周期要求高对称性）
      volume_pattern: 0.20              # 成交量模式权重
      size_proportion: 0.05             # 尺寸比例权重（长周期不太关注大小）
      apex_validity: 0.10               # 顶点有效性权重
    '1w':
      convergence_quality: 0.38         # 收敛质量权重
      symmetry: 0.32                    # 对称性权重
      volume_pattern: 0.17              # 成交量模式权重
      size_proportion: 0.03             # 尺寸比例权重
      apex_validity: 0.10               # 顶点有效性权重
    '1M':
      convergence_quality: 0.40         # 收敛质量权重（最重视收敛质量）
      symmetry: 0.35                    # 对称性权重（最高对称性要求）
      volume_pattern: 0.15              # 成交量模式权重
      size_proportion: 0.02             # 尺寸比例权重
      apex_validity: 0.08               # 顶点有效性权重

# 技术指标配置
indicators:
  moving_averages: [5, 10, 20, 50]    # 移动平均线周期设置
  rsi_period: 14                      # RSI相对强弱指标周期
  macd_fast: 12                       # MACD快线周期
  macd_slow: 26                       # MACD慢线周期
  macd_signal: 9                      # MACD信号线周期
  bollinger_period: 20                # 布林带周期
  bollinger_std: 2                    # 布林带标准差倍数

# 输出设置
output:
  base_path: "output"                 # 输出文件根目录
  data_path: "output/data"            # 数据文件输出目录
  charts_path: "output/charts"        # 图表文件输出目录
  reports_path: "output/reports"      # 报告文件输出目录
  charts:
    format: "png"                     # 图表格式（png/jpg/svg）
    width: 1200                       # 图表宽度（像素）
    height: 800                       # 图表高度（像素）
    dpi: 300                          # 图表分辨率（DPI）
  dataset:
    format: "json"                    # 数据集导出格式（json/csv/excel）
    backup_enabled: true              # 是否启用数据备份

# 日志设置
logging:
  level: "INFO"                       # 日志级别（DEBUG/INFO/WARNING/ERROR）
  file: "logs/pattern_scout.log"      # 日志文件路径
  max_size: "10MB"                    # 单个日志文件最大大小
  backup_count: 5                     # 保留的历史日志文件数量

# 多周期检测设置
multi_timeframe:
  enabled: false                      # 是否启用多周期检测模式
  base_timeframe: "1m"                # 基础数据周期（用于重采样）
  target_timeframes: ["5m", "15m", "1h", "4h", "1d"]  # 要检测的8个周期列表
  require_confirmation: false         # 是否要求多周期确认（所有周期都检测到才算有效）

# 突破分析设置
breakthrough_analysis:
  enabled: true                       # 是否启用形态突破分析
  lookforward_bars: 20                # 形态完成后向前查看的K线数量
  success_threshold: 1.5              # 判定突破成功的价格变化阈值（%）
  volume_confirmation: true           # 突破时是否需要成交量确认